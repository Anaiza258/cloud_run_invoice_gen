<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
   <title>AI Invoice Generator | Free & Pro Plans</title>
<meta name="description" content="AI-powered voice-to-invoice generator for freelancers, startups, and businesses. Create invoices in seconds with AI.">
<meta name="keywords" content="AI invoice generator, voice to invoice, invoice automation, free invoice tool, free invoice generator, ">
  
  <!-- Bootstrap 5 CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css">
  <!-- Google Fonts - Poppins -->
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
  
  <!-- FontAwesome Icons -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">

  <style>
      @import url('https://fonts.googleapis.com/css2?family=Roboto+Condensed:ital,wght@0,100..900;1,100..900&display=swap');
    
    /* Theme Variables */
    :root {
      --nav-height: 72px;
      --bg-primary: #1a1f2e;
      --bg-card: #242937;
      --bg-input: #2a324a;
      --accent-primary: #6d5cff;
      --accent-secondary: #00d4ff;
      --text-primary: #ffffff;
      --text-secondary: rgba(255, 255, 255, 0.849);
      --border: rgba(255,255,255,0.1);
      --heading-gradient: linear-gradient(90deg, #c2eafa 40%, #62e8f9 90%);
    }


    /* Base Styles */
    body {
      font-family: 'Poppins', sans-serif !important;
      color: var(--text-primary);
      margin: 0;
      padding: 0;
      padding-top: var(--nav-height);

  background: radial-gradient(circle at 30% 80%, #00d4ff 10%, transparent 65%),
            radial-gradient(circle at 75% 25%, #6d5cff 7%, transparent 50%),
            linear-gradient(160deg, #1a1f2e, #2a324a, #242937);
            background-size: cover;
            background-attachment: fixed; 

    }
    
  
    /* Gradient text  */
    /* .animated-gradient-text {
      background: linear-gradient(90deg, #ffffff, #00d4ff);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.1);
    line-height: 1.2;
    text-align: center;
    font-family: "Roboto Condensed", serif;
    font-optical-sizing: auto;
    font-weight: 700;
    font-size: 2.1rem;
    font-style: normal;
    }  */

    /* .tagline p {
  font-size: 1.16rem;
  text-align: center;
  font-family: "Roboto Condensed", serif;
  font-optical-sizing: auto;
  font-weight: 300;
  font-style: normal;
  line-height: 1.7;
    } */


 /* container box  */
    .container-box {
      max-width: 700px;
      margin: 0 auto;
      margin-top: 3rem;
      /* padding: 2px; */
    
    }
  
     /* Input container box */
    .input-container {
     /* padding: 20px 20px 3px 20px; */
     margin-top: 70px;
      border: 1px solid var(--border);
      border-radius: 1rem;
      padding: 1rem ;

      background: rgba(30, 36, 54, 0.6);
backdrop-filter: blur(15px);
border: 1px solid rgba(255, 255, 255, 0.1);
box-shadow: 0 0 25px rgba(109, 92, 255, 0.2), 0 0 40px rgba(0, 212, 255, 0.1);

  transition: transform 0.3s ease;
    }

    .input-container:hover {
      transform: translateY(-5px);
    }

      /* Input section  */
    .input-section {
  max-height: 300px;
  border: 1px solid rgba(255, 255, 255, 0.08);
  border-radius: 1rem;
  padding: 1.35rem;
  background: radial-gradient(circle at 30% 80%, rgba(0, 212, 255, 0.25) 0%, 
      rgba(26, 31, 46, 0.9) 50%),
      linear-gradient(145deg, rgba(42, 50, 74, 0.9), rgba(26, 31, 46, 0.9));
  box-shadow: 0 10px 35px rgba(0, 0, 0, 0.5),
              0 0 50px rgba(0, 212, 255, 0.3);
  backdrop-filter: blur(14px);
  transition: box-shadow 0.4s ease;
}

.input-section:hover {
  box-shadow: 0 0 80px rgba(0, 212, 255, 0.5);
}

    /* Input Section Heading */
.input-section p {
  font-size: 1.1rem; 
  font-weight: 400; 
  color: #ffffff; 
  margin-bottom: 0.8rem; 
  font-family: "roboto condensed", serif;

}

/* Input Section Paragraph  */
/* .input-section p {
  font-size: 0.95rem; 
  font-weight: 400; 
  color: rgba(235, 240, 255, 0.85); 
  line-height: 1.5; 
  white-space: auto; 
  overflow: hidden; 
  text-overflow: ellipsis; 
} */


    /* Input form  */
    .form-control, .form-select {
      background-color:  rgba(26, 31, 46, 0.9);
      border: 1px solid var(--border);
      color: var(--text-primary);
      border-radius: 0.5rem;
      padding: 0.35rem;
      font-size: 0.9rem;
    }
    .form-control:focus, .form-select:focus {
      border-color: var(--accent-primary);
      box-shadow: 0 0 0 0.25rem rgba(0,212,255,0.1);
      outline: none;
    }
    .form-control::placeholder {
      color: var(--text-secondary);
      padding: 0.5rem;
      padding: 0.35rem;
    }
    
    /* input buttons  */
    .btn-app {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      background: linear-gradient(135deg, var(--accent-primary) 0%, #3b5ef5 100%);
      color: var(--text-primary);
      border: none;
      padding: 0.75rem 1.5rem;
      border-radius: 0.5rem;
      font-weight: 500;
      transition: all 0.3s;
    }
    .btn-app:hover {
      transform: translateY(-1px);
      box-shadow: 0 4px 12px rgba(79,110,247,0.3);
    }
    .btn-outline {
      background: transparent;
      border: 0.2px solid var(--border);
      color: var(--text-primary);
    }
    .btn-outline:hover {
      background: rgba(79,110,247,0.1);
    }

    .floating-mic {
      position: fixed;
      bottom: 20px;
      right: 20px;
      background: var(--accent-primary);
      color: var(--text-primary);
      width: 65px;
      height: 65px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0px 4px 15px rgba(0,0,0,0.5);
      cursor: pointer;
      transition: all 0.3s ease;
      animation: pulse 1.5s infinite;
    }
    .floating-mic:hover {
      background: #3b5ef5;
      box-shadow: 0px 4px 20px rgba(0,75,160,0.8);
    }
    @keyframes pulse {
      0% { transform: scale(1); }
      50% { transform: scale(1.1); }
      100% { transform: scale(1); }
    }
  


    .floating-mic.recording {
      background: #ff3d00; 
      box-shadow: 0px 4px 15px rgba(255, 61, 0, 0.5); 
    }


    .floating-mic.recording i {
      color: white; 
    }


    .floating-mic i.recording {
      content: "\f04d"; 
    }
    .floating-timer {
      position: absolute;
      bottom: -18px; /* Position just below the mic icon */
      left: 50%;
      transform: translateX(-50%);
      font-size: 12px;
      color: white;
      font-weight: bold;
      text-shadow: 0 0 4px rgba(0,0,0,0.7);
    }
    .floating-mic #floatingVisualizer {
      position: absolute;
      bottom: 72px; /* Positioned below the mic button and timer */
      left: 50%;
      transform: translateX(-50%);
      width: 60px;
      height: 26px;
      background: linear-gradient(135deg, #131b2a 0%, #6d5cff 100%);
      border-radius: 5px;
      box-shadow: 0 0 10px rgba(0, 0, 0, 0.5);
      opacity: 0.7;
    }
    .floating-mic #visualizer {
      border-radius: 5px;
      /* position: absolute;
      bottom: 72px; /* Positioned below the mic button and timer */
      /* left: 50%;
      transform: translateX(-50%);
      width: 60px;
      height: 26px;
      background: linear-gradient(135deg, #131b2a 0%, #6d5cff 100%);
      box-shadow: 0 0 10px rgba(0, 0, 0, 0.5);
      opacity: 0.7;  */
    }
  /* Floating Mic Visualizer (Bars) */
  .floating-visualizer {
    position: absolute;
    bottom: -35px; /* Positioned below the mic button and timer */
    left: 50%;
    transform: translateX(-50%);
    width: 60px;
    height: 10px;
    background: linear-gradient(135deg, #00d4ff 0%, #6d5cff 100%);
    border-radius: 5px;
    box-shadow: 0 0 10px rgba(0, 0, 0, 0.5);
    opacity: 0.7;
  }

  .floating-visualizer-bar {
    position: absolute;
    width: 5px;
    height: 100%;
    background-color: #ff3d00;
    border-radius: 3px;
    animation: pulse 0.5s ease-in-out infinite;
  }

    /* review and edit form  */
    .service-row {
      background: var(--bg-card);
      border: 1px solid var(--border);
      padding: 15px;
      margin-bottom: 15px;
      border-radius: 5px;
      position: relative;
    }
    .remove-service {
      position: absolute;
      top: 10px;
      right: 10px;
      color: #d9534f;
      cursor: pointer;
    }

    /* add new service btn  */
    .btn--btn {
      background: linear-gradient(135deg, var(--accent-primary) 0%, #2a324a 100%);
      border: none;
    }

      /* add & remove btn  */
    .toggle-btn {
      padding: 2px 6px;
      font-size: 0.8rem;
      line-height: 1;
      border: 1px solid var(--border);
      border-radius: 1rem;
      background: transparent;
      color: var(--text-primary);
    }

      /* save invoice btn  */
    .btn-custom {
      background: linear-gradient(135deg, var(--accent-primary) 0%, #3b5ef5 100%);
    }
    
    #invoiceFormDiv {
      animation: formFadeIn 1s ease-out;
    }
    @keyframes formFadeIn {
      from {
        opacity: 0;
        transform: translateY(30px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

       /* loader  */
    #loaderOverlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.75);
      display: none;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      z-index: 9999;
    }
    .custom-loader {
      position: relative;
      width: 50px;
      height: 50px;
    }
    .custom-loader .dot {
      position: absolute;
      top: 50%;
      left: 50%;
      width: 12px;
      height: 12px;
      background-color: #ff3d00;
      border-radius: 50%;
      transform: translate(-50%, -50%);
      animation: pulseDot 1s infinite;
    }
    .custom-loader::after {
      content: "";
      position: absolute;
      top: 0;
      left: 0;
      width: 50px;
      height: 50px;
      border: 3px solid #00d4ff;
      border-radius: 50%;
      animation: ripple 1.5s infinite;
    }
    @keyframes pulseDot {
      0% { transform: translate(-50%, -50%) scale(1); opacity: 1; }
      50% { transform: translate(-50%, -50%) scale(1.5); opacity: 0.5; }
      100% { transform: translate(-50%, -50%) scale(1); opacity: 1; }
    }
    @keyframes ripple {
      0% { transform: scale(0.7); opacity: 1; }
      100% { transform: scale(1.5); opacity: 0; }
    }
    #loaderMessage {
      margin-top: 1rem;
      font-size: 1.1rem;
      font-weight: bold;
      background: linear-gradient(to right, #ff6a00, #ee0979);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      text-align: center;
    }

    /* File Upload Box Styling */
    .file-upload-box {
    width: 150px;
    height: 120px;
    background-color: var(--bg-card);
    border: 2px solid var(--accent-primary);
    border-radius: 12px;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    position: relative;
    margin-bottom: 20px;
    transition: all 0.3s ease;
    padding: 15px;
}

.file-upload-box:hover {
    background-color: var(--bg-card);
    border-color: var(--accent-secondary);
}

/* Upload icon styling */
.file-upload-box .upload-icon {
    font-size:30px;
    color: var(--accent-primary);
    margin-bottom: 10px;
    transition: transform 0.3s ease;
}

.file-upload-box:hover .upload-icon {
    transform: translateY(-3px);
    color: var(--accent-secondary);
}

/* Text content styling */
.file-upload-box .upload-text {
    display: flex;
    flex-direction: column;
    align-items: center;
    text-align: center;
}

.file-upload-box .main-text {
    font-family: 'Roboto', sans-serif;
    font-size: 0.8rem;
    font-weight: 500;
    color: var(--text-primary);
    margin-bottom: 3px;
}

/* Optional label styling */
.file-upload-box .optional-text {
    font-family: 'Roboto', sans-serif;
    font-size: 0.7rem;
    color: var(--text-primary);
    background-color: var(--accent-primary);
    padding: 2px 6px;
    border-radius: 12px;
    margin-top: 8px;
}

.file-upload-box:hover .optional-text {
    transform: translateY(-3px);
    background-color: var(--accent-secondary);
}

/* Preview image container */
.file-upload-box .preview-container {
    width: 100%;
    height: 100%;
    display: flex;
    align-items: center;
    justify-content: center;
    position: relative;
}

/* Preview image styling */
.file-upload-box img {
    max-width: 100%;
    max-height: 100%;
    object-fit: contain;
    border-radius: 8px;
}

/* Remove button styling */
.file-upload-box .remove-file {
    position: absolute;
    top: 8px;
    right: 8px;
    background: var(--accent-secondary);
    color: var(--text-primary);
    border: none;
    border-radius: 50%;
    width: 24px;
    height: 24px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 14px;
    cursor: pointer;
    transition: all 0.3s ease;
    z-index: 2;
}

.file-upload-box .remove-file:hover {
    background: var(--accent-primary);
    transform: scale(1.1);
}

    /* Payment Status Toggle Styling */
    .payment-status-wrapper {
        margin-top: 7px;
    }
    
    .payment-status-toggle {
        display: flex;
        gap: 10px;
        background: var(--bg-input);
        padding: 8px;
        border-radius: 8px;
        border: 1px solid var(--border);
    }
    
    .payment-status-toggle input[type="radio"] {
        display: none;
    }
    
    .status-label {
        display: flex;
        align-items: center;
        gap: 10px;
        padding: 8px 12px 8px 12px;
        border-radius: 6px;
        cursor: pointer;
        transition: all 0.3s ease;
        font-weight: 500;
    }
    
    .status-label.unpaid {
        color: #ff4d4d;
    }
    
    .status-label.paid {
        color: #4CAF50;
    }
    
    .payment-status-toggle input[type="radio"]:checked + .status-label {
        background: rgba(255, 255, 255, 0.1);
    }
    
    .payment-status-toggle input[type="radio"]:checked + .status-label.unpaid {
        background: rgba(255, 77, 77, 0.1);
    }
    
    .payment-status-toggle input[type="radio"]:checked + .status-label.paid {
        background: rgba(76, 175, 80, 0.1);
    }



/* Input Tabs  */
.input-tab {
  padding: 0.7rem 2rem;
  border: none;
  border-radius: 2rem;
  font-size: 1.1rem;
  font-weight: 600;
  color: rgba(255, 255, 255, 0.8);
  background: rgba(255, 255, 255, 0.1);
  cursor: pointer;
  transition: all 0.3s ease;
}

/* Active Tab */
.input-tab.active {
  background: linear-gradient(90deg, #00d4ff, #6d5cff);
  color: #ffffff;
  box-shadow: 0 0 25px rgba(0, 212, 255, 0.4);
  transform: translateY(-2px);
}

/* Hover Effect for Better Interaction */
.input-tab:hover {
  background: rgba(0, 212, 255, 0.2);
}

/* OR Divider*/
.or-divider {
  font-size: 1.5rem;
  font-weight: 700;
  color: rgba(255, 255, 255, 0.85);
  text-shadow: 0 0 15px rgba(0, 212, 255, 0.4);
  transition: color 0.3s ease;
}

/* Input Sections*/
.input-section {
  transition: opacity 0.4s ease, transform 0.4s ease;
}

/* Hide/Show with Animation */
.input-section.d-none {
  opacity: 0;
  transform: translateY(20px);
  pointer-events: none; /* Prevent Interaction */
}


/* Button Styling  */
#generateTextBtn {
  background: linear-gradient(145deg, #32415c, #50a0cf); 
  border: none; 
  transition: background 0.3s ease, transform 0.3s ease;
}

/* Hover Effect  */
#generateTextBtn:hover {
  background: linear-gradient(145deg, #3a5174, #65b7e5); 
  transform: translateY(-2px); 
}

/* hero section  */

    .tool-hero {
      text-align: center;
      margin-top: 2.4rem;
      margin-bottom: 1.5rem;
    }
    .tool-hero .main-hero-heading {
      font-size: 3.5rem;
      font-weight: 600;
      background: var(--heading-gradient);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      margin-bottom: 0.1rem;
    }
    .tool-hero .tool-subheading {
      font-size: 1.5rem;
      font-weight: 600;
      color: #38e6fd;
      margin-bottom: 0.65rem;
      letter-spacing: 0.02em;
    }
    .tool-hero .tool-desc {
      color: var(--text-secondary);
      font-size: 1.11rem;
      font-weight: 400;
      max-width: 650px;
      margin: 0 auto 0.55rem auto;
      line-height: 1.65;
    }

      /* nav bar  */
    .stylish-logo {
      font-size: 2rem;
      /* background: linear-gradient(90deg, #ff3cff   0%, #7a3cff 100%); */
background: linear-gradient(90deg, #61c0ff 0%, #ff3cff 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      font-weight: 800;
      text-transform: uppercase;
    }

    .navbar-custom,
    .navbar-custom .nav-link,
    .navbar-custom .btn-outline-secondary {
      color: #fff !important;
      font-size: 17px;
    }

    /* Get Started Button */
    .get-started-btn {
      font-weight: 600;
      border-radius: 2rem;
      background: linear-gradient(90deg, #43cea2 0%, #185a9d 100%);
      color: #fff !important;
      box-shadow: 0 2px 8px rgba(67, 206, 162, 0.1);
      transition: transform 0.1s, box-shadow 0.1s;
    }

    .get-started-btn:hover {
      transform: translateY(-2px) scale(1.04);
      box-shadow: 0 4px 16px rgba(67, 206, 162, 0.18);
      color: #fff !important;
    }

    .navbar-custom {
      font-family: 'Poppins', sans-serif !important;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: var(--nav-height);
      z-index: 40;

      /* subtle translucent dark shell so text is readable but background still shows */
      background: linear-gradient(180deg, rgba(30, 34, 46, 0.18), rgba(30, 34, 46, 0.08));
      backdrop-filter: blur(8px) saturate(120%);
      -webkit-backdrop-filter: blur(8px) saturate(120%);

      border-bottom: 1px solid rgba(255, 255, 255, 0.04);
      transition: background .18s ease, transform .18s ease;
    }

     /* Nav Underline Effect */
.nav-underline {
  position: relative;
  color: #fff !important;
  transition: color 0.25s ease;
}

/* Hover + Active underline */
.nav-underline::after {
  content: "";
  position: absolute;
  left: 0;
  right: 0;
  bottom: -2px; 
  height: 3px;
  background: linear-gradient(90deg, #43cea2 0%, #185a9d 100%);
  border-radius: 2px;
  transform: scaleX(0);
  transform-origin: center;
  transition: transform 0.25s cubic-bezier(.4, 0, .2, 1);
}

/* Show underline only when active or hovered */
.nav-underline:hover::after,
.nav-underline.active::after {
  transform: scaleX(1);
}

/* Active link color */
.nav-underline.active {
  color: #43cea2 !important; 
  font-weight: 600; 
}

    @media (max-width: 991.98px) {
      .navbar-nav {
        gap: 0 !important;
      }

      .get-started-btn {
        margin-left: 0 !important;
        margin-top: 0.5rem;
      }

      .d-flex.align-items-center {
        margin-top: 0.5rem;
      }
    }
    
    /* Footer Styles */
    .footer {
      background: linear-gradient(180deg, rgba(18,21,32,0.97), rgba(26,31,46,0.98));
      color: #cbd5e1;
      font-size: 0.95rem;
      padding-top: 2rem;
    }
    .footer-logo {
      font-size: 1.6rem;
      font-weight: 800;
      background: linear-gradient(90deg, #61c0ff 0%, #ff3cff 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      text-transform: uppercase;
      letter-spacing: 1px;
      text-decoration: none;
    }
    .footer p {
      margin: 0;
      color: #94a3b8;
      line-height: 1.6;
    }
    .footer h6 {
      color: #e2e8f0;
      font-size: 1rem;
    }
    .footer ul {
      list-style: none;
      padding: 0;
      margin: 0;
    }
    .footer ul li {
      margin-bottom: 0.5rem;
    }
    .footer ul li a {
      color: #cbd5e1;
      text-decoration: none;
      transition: color 0.2s ease;
      font-weight: 500;
    }
    .footer ul li a:hover {
      color: #00d9f5;
    }
    .footer .social-icons a {
      display: inline-block;
      margin-right: 0.6rem;
      font-size: 1.25rem;
      color: #cbd5e1;
      transition: color 0.3s, transform 0.3s;
    }
    .footer .social-icons a:hover {
      color: #00f5a0;
      transform: translateY(-2px);
    }
    .footer hr {
      border-color: rgba(255,255,255,0.08);
    }
    

  </style>
</head>
<body >
 
  <!-- Navbar (Header) -->
  <header>
  <nav class="navbar navbar-expand-lg navbar-custom shadow-sm">
    <div class="container">
      <!-- LEFT: Stylish Text Logo -->
      <a class="navbar-brand stylish-logo" href="{{ url_for('index') }}">InvoiceGen</a>

      <!-- Hamburger for mobile -->
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#mainNavbar"
        aria-controls="mainNavbar" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>

      <!-- Center and Right Sections -->
      <div class="collapse navbar-collapse" id="mainNavbar">
        <!-- Center Nav Items -->
        <ul class="navbar-nav mx-auto mb-2 mb-lg-0 align-items-lg-center gap-lg-2">
          <li class="nav-item">
            <a class="nav-link nav-underline" href="{{ url_for('index') }}">Home</a>
          </li>
          <li class="nav-item">
            <a class="nav-link nav-underline" href="javascript:void(0)" onclick="goToTool(event)">Generate Invoice</a>
          </li>
          <li class="nav-item">
            <a class="nav-link nav-underline" href="{{ url_for('pricing') }}">Pricing</a>
          </li>
          <li class="nav-item">
            <a class="nav-link nav-underline" href="{{ url_for('contact') }}">Contact us</a>
          </li>
          <li class="nav-item">
            <a class="btn btn-primary px-4 ms-lg-3 get-started-btn" href="javascript:void(0)" onclick="goToTool(event)">
              Get Started Free
            </a>
          </li>
        </ul>

        <!-- Right Auth Buttons -->
        <div class="d-flex align-items-center gap-2 ms-lg-3" id="auth-buttons">
          <a class="btn btn-outline-secondary" href="#">Sign In</a>
          <a class="btn btn-success ms-1" href="#">Sign Up</a>
        </div>
      </div>
    </div>
  </nav>
</header>


  <!-- Hero/Intro -->
  <div class="tool-hero">
    <div class="main-hero-heading">Create Your Invoice</div>
    <div class="tool-desc">
      Speak or type your invoice details, review instantly, and download or send to your client. Simple, smart, and secure.
    </div>
  </div>


  <div class="container-box">
       

    <!-- Main Input Section -->
    <div class="input-container " id="mainContainer">

       <!-- Input Type Tabs with OR Separator -->
       <div class="input-toggle  d-flex justify-content-center mb-3 gap-3 ">
        <!-- Voice Input Tab -->
        <button class="input-tab active " id="voiceTab"> Voice Input</button>
    
        <!-- OR Separator -->
        <div class="or-divider">OR</div>
    
        <!-- Text Input Tab -->
        <button class="input-tab " id="textTab"> Text Input</button>
      </div>
    
      <!-- Voice Input Section -->
      <div id="voiceInput" class="input-section active  ">
        <p>Click to start speaking your invoice details</p>
        <!-- <p>Use your voice to record invoice details. Click the mic to start.</p> -->
        <button class="btn btn-primary w-100" id="recordButton">
          <i class="fas fa-microphone-alt me-2"></i>Start Recording
        </button>
        <button class="btn btn-outline-light w-100 mt-2" id="stopButton" disabled>
          <i class="fas fa-stop-circle me-2"></i>Stop Recording
        </button>
        <div id="timer-visualizer" style="display: none;">
        <div id="voiceTimer" class="mt-2">00:00</div> 
        <canvas id="visualizer" width="100" height="40" style="border: 1px solid #fff; border-radius: 5px;"></canvas>
        <!-- <canvas id="visualizer" width="100%" height="100" class="mt-2" style="display--: none; margin: 10px auto; background: rgba(0, 0, 0, 0.2); border-radius: 8px;"></canvas> -->

        </div>
      </div>
    
      <!-- Text Input Section -->
      <div id="textInput" class="input-section d-none  ">
        <p>Type your details below</p>
        <!-- <p>Or, manually type your invoice details below.</p> -->
        <textarea id="invoiceText" class="form-control" placeholder="Enter invoice details..." rows="6"></textarea>
        <button class="btn btn-primary w-60  mt-3 " id="generateTextBtn">
          <i class="fas fa-magic me-2"></i>Generate from Text
        </button>
      </div>
    </div>
    
    
    <!-- Review Form Section -->
    <div id="invoiceFormDiv" class="input-container" style="display: none;">
      <div class="text-center mb-4">
        <h2 class="mb-0">Review & Edit Invoice</h2>
        <div class="status-badge mt-2">
          <i class="fas fa-edit me-2"></i>Edit Mode
        </div>
      </div>
      <form id="invoiceForm"  enctype="multipart/form-data">
        <!-- Logo Upload Box -->
        <div class="row mb-3">
          <div class="col-md-4">
            <div class="d-flex align-items-center">
              <label class="form-label mb-2">Logo Upload</label>
              <button type="button" class="btn btn-outline-primary btn-sm ms-2 toggle-btn mb-2" data-bs-toggle="collapse" data-bs-target="#collapseLogoUpload" aria-expanded="true" aria-controls="collapseLogoUpload">Remove</button>
            </div>
            <div class="collapse show" id="collapseLogoUpload">
              <div id="logoUploadBox" class="file-upload-box">
                <div class="upload-content">
                  <i class="fas fa-image upload-icon"></i>
                  <div class="upload-text">
                    <span class="main-text">Upload Logo</span>
                    <span class="optional-text">Optional</span>
                  </div>
                </div>
              </div>
              <input type="file" id="logoFileInput" name="logo" accept="image/jpeg, image/png" style="display: none;">
            </div>
          </div>
          <!-- Payment Status Selection with custom styling -->
          <div class="col-md-4">
            <div class="d-flex align-items-center">
              <label class="form-label mb-2">Payment Status</label>
              <button type="button" class="btn btn-outline-primary btn-sm ms-2 toggle-btn mb-2" data-bs-toggle="collapse" data-bs-target="#collapsePaymentStatus" aria-expanded="true" aria-controls="collapsePaymentStatus">Remove</button>
            </div>
            <div class="collapse show" id="collapsePaymentStatus">
              <div class="payment-status-wrapper">
                <div class="payment-status-toggle">
                  <input type="radio" id="statusUnpaid" name="payment_status" value="UNPAID" checked>
                  <label for="statusUnpaid" class="status-label unpaid">
                    <i class="fas fa-times-circle"></i> UNPAID
                  </label>
                  <input type="radio" id="statusPaid" name="payment_status" value="PAID">
                  <label for="statusPaid" class="status-label paid">
                    <i class="fas fa-check-circle"></i> PAID
                  </label>
                </div>
              </div>
            </div>
          </div>
        </div>
        
        <!-- Invoice Metadata Fields -->
        <div class="row mb-3">
          <div class="col-md-4">
            <label for="invoiceNumber" class="form-label">Invoice Number</label>
            <input type="text" class="form-control" id="invoiceNumber" name="invoiceNumber" placeholder="INV-10">
          </div>
          <div class="col-md-4">
            <label class="form-label">
              Issue Date 
              <button type="button" class="btn btn-outline-primary btn-sm toggle-btn" data-bs-toggle="collapse" data-bs-target="#collapseIssueDate" aria-expanded="true" aria-controls="collapseIssueDate">Remove</button>
            </label>
            <div class="collapse show" id="collapseIssueDate">
              <input type="date" class="form-control" id="issueDate" name="issueDate">
            </div>
          </div>
          <div class="col-md-4">
            <label class="form-label">
              Due Date 
              <button type="button" class="btn btn-outline-primary btn-sm toggle-btn" data-bs-toggle="collapse" data-bs-target="#collapseDueDate" aria-expanded="true" aria-controls="collapseDueDate">Remove</button>
            </label>
            <div class="collapse show" id="collapseDueDate">
              <input type="date" class="form-control" id="dueDate" name="dueDate">
            </div>
          </div>
        </div>
  
        <!-- Issuer Details Section -->
        <h4 class="mt-4">Your Details (Issuer)</h4>
        <div class="row mb-3">
          <div class="col-md-4">
            <label for="issuerName" class="form-label">Your Name</label>
            <input type="text" class="form-control" id="issuerName" name="issuerName" placeholder="Your Name">
          </div>
          <div class="col-md-4">
            <label for="issuerContact" class="form-label">
              Your Contact 
              <button type="button" class="btn btn-outline-primary btn-sm toggle-btn" data-bs-toggle="collapse" data-bs-target="#collapseIssuerContact" aria-expanded="true" aria-controls="collapseIssuerContact">Remove</button>
            </label>
            <div class="collapse show" id="collapseIssuerContact">
              <input type="text" class="form-control" id="issuerContact" name="issuerContact" placeholder="Your Contact">
            </div>
          </div>
          <div class="col-md-4">
            <label class="form-label">
              Your Email 
              <button type="button" class="btn btn-outline-primary btn-sm toggle-btn" data-bs-toggle="collapse" data-bs-target="#collapseIssuerEmail" aria-expanded="true" aria-controls="collapseIssuerEmail">Remove</button>
            </label>
            <div class="collapse show" id="collapseIssuerEmail">
              <input type="text" class="form-control" id="issuerEmail" name="issuerEmail" placeholder="Your Email">
            </div>
          </div>
        </div>
        <div class="row mt-3">
          <div class="col-md-4">
            <label class="form-label">
                Your Address 
              <button type="button" class="btn btn-outline-primary btn-sm toggle-btn" data-bs-toggle="collapse" data-bs-target="#collapseIssuerAddress" aria-expanded="true" aria-controls="collapseIssuerAddress">Remove</button>
            </label>
            <div class="collapse show" id="collapseIssuerAddress">
              <input type="text" class="form-control" id="issuerAddress" name="issuerAddress" placeholder="Your Address">
            </div>
          </div>
        </div>
        
  
        <!-- Client Details Section -->
        <h4 class="mt-4">Client Details</h4>
        <div class="row mb-3">
          <div class="col-md-4">
            <label for="clientName" class="form-label">Client Name</label>
            <input type="text" class="form-control" id="clientName" name="clientName" placeholder="Client Name">
          </div>
          <div class="col-md-4">
            <label for="clientContact" class="form-label">
              Client Contact 
              <button type="button" class="btn btn-outline-primary btn-sm toggle-btn" data-bs-toggle="collapse" data-bs-target="#collapseClientContact" aria-expanded="true" aria-controls="collapseClientContact">Remove</button>
            </label>
            <div class="collapse show" id="collapseClientContact">
              <input type="text" class="form-control" id="clientContact" name="clientContact" placeholder="Client Contact">
            </div>
          </div>
          <div class="col-md-4">
            <label class="form-label">
              Client Email 
              <button type="button" class="btn btn-outline-primary btn-sm toggle-btn" data-bs-toggle="collapse" data-bs-target="#collapseClientEmail" aria-expanded="true" aria-controls="collapseClientEmail">Remove</button>
            </label>
            <div class="collapse show" id="collapseClientEmail">
              <input type="text" class="form-control" id="clientEmail" name="clientEmail" placeholder="Client Email">
            </div>
          </div>
        </div>
        <div class="row mt-3">
          <div class="col-md-4">
            <label class="form-label">
              Client Address 
              <button type="button" class="btn btn-outline-primary btn-sm toggle-btn" data-bs-toggle="collapse" data-bs-target="#collapseClientAddress" aria-expanded="true" aria-controls="collapseClientAddress">Remove</button>
            </label>
            <div class="collapse show" id="collapseClientAddress">
              <input type="text" class="form-control" id="clientAddress" name="clientAddress" placeholder="Client Address">
            </div>
          </div>
        </div>
  
        <!-- Service Details Section -->
        <h3 class="mt-4 mb-3">Service Details</h3>
        <div class="row mb-3">
          <div class="col-md-4">
            <label for="currencySelection" class="form-label">Select Currency</label>
            <select class="form-select" id="currencySelection" name="currency">
              <option value="" selected>None</option>
              <option value="$">USD ($)</option>
              <option value="PKR">PKR (₨)</option>
              <option value="€">EUR (€)</option>
              <option value="£">GBP (£)</option>
              <option value="₹">INR (₹)</option>
              <option value="¥">JPY (¥)</option>
              <option value="CAD">CAD ($)</option>
              <option value="AUD">AUD ($)</option>
              <option value="CNY">CNY (¥)</option>
              <option value="RUB">RUB (₽)</option>
            </select>
          </div>
        </div>
        <div id="servicesContainer" class="mb-3"></div>
        <div class="mb-3">
          <button type="button" class="btn btn-dark btn--btn" id="addServiceRow">Add New Service</button>
        </div>
        <!--  Subtotal & Vat Section -->
        <div class="row mb-3">
          <div class="col-md-4">
            <label class="form-label">Subtotal</label>
            <input type="text" class="form-control" id="serviceSubtotal" name="serviceSubtotal" placeholder="Subtotal" readonly>
          </div>
          <!-- VAT Option-->
          <div class="col-md-4">
            <div class="d-flex align-items-center">
                <label class="form-label mb-2">VAT(% or fixed)</label>
                <button type="button" class="btn btn-outline-primary btn-sm ms-2 toggle-btn mb-2" data-bs-toggle="collapse" data-bs-target="#collapseVatAmount" aria-expanded="true" aria-controls="collapseVatAmount">Remove</button>
            </div>
            <div class="collapse show" id="collapseVatAmount">
                <div class="input-group">
                    <input type="text" class="form-control" id="vatAmount" name="vatAmount" placeholder="0"/>
                    <select class="form-select" id="vatOption" name="vatOption">
                        <option value="percentage" selected>VAT as %</option>
                        <option value="fixed">Fixed Amount</option>
                    </select>
                </div>
            </div>
          </div>
          <!-- TAX Option-->
          <div class="col-md-4">
            <div class="d-flex align-items-center">
                <label class="form-label mb-2">TAX(% or fixed)</label>
                <button type="button" class="btn btn-outline-primary btn-sm ms-2 toggle-btn mb-2" data-bs-toggle="collapse" data-bs-target="#collapseTaxAmount" aria-expanded="true" aria-controls="collapseTaxAmount">Remove</button>
            </div>
            <div class="collapse show" id="collapseTaxAmount">
                <div class="input-group">
                    <input type="text" class="form-control" id="taxAmount" name="taxAmount" placeholder="0"/>
                    <select class="form-select" id="taxOption" name="taxOption">
                        <option value="percentage" selected>TAX as %</option>
                        <option value="fixed">Fixed Amount</option>
                    </select>
                </div>
            </div>
        </div>
        </div>
      
        <div class="row mb-3">
          <div class="col-md-4">
            <label class="form-label">
              Shipping Cost 
              <button type="button" class="btn btn-outline-primary btn-sm toggle-btn" data-bs-toggle="collapse" data-bs-target="#collapseShippingCost" aria-expanded="true" aria-controls="collapseShippingCost">Remove</button>
            </label>
            <div class="collapse show" id="collapseShippingCost">
              <input type="text" class="form-control" id="shippingCost" name="shippingCost" placeholder="e.g., $50.00">
            </div>
          </div>
          <div class="col-md-4">
            <label class="form-label">Total Amount</label>
            <input type="text" class="form-control" id="totalAmount" name="totalAmount" placeholder="e.g., $1500">
          </div>
          <div class="col-md-4">
            <label class="form-label">
              Payment Method 
              <button type="button" class="btn btn-outline-primary btn-sm toggle-btn" data-bs-toggle="collapse" data-bs-target="#collapsePaymentMethod" aria-expanded="true" aria-controls="collapsePaymentMethod">Remove</button>
            </label>
            <div class="collapse show" id="collapsePaymentMethod">
              <input type="text" class="form-control" id="paymentMethod" name="paymentMethod" placeholder="e.g., Credit Card">
            </div>
          </div>
        </div>
        <div class="row mb-3">
          <div class="col-md-12">
            <div class="mb-3">
              <label class="form-label">
                End Note 
                <button type="button" class="btn btn-outline-primary btn-sm toggle-btn" data-bs-toggle="collapse" data-bs-target="#collapseEndNote" aria-expanded="true" aria-controls="collapseEndNote">Remove</button>
              </label>
              <div class="collapse show" id="collapseEndNote">
                <textarea class="form-control" id="endNote" name="endNote" rows="3" placeholder="Enter your end note here..."></textarea>
              </div>
            </div>
          </div>
        </div>
        <button type="button" class="btn btn-primary btn-custom w-100" id="saveInvoiceBtn">Save Invoice</button>
      </form>
    </div>
  </div>

   <!-- Loader Overlay -->
  <div id="loaderOverlay">
    <div class="custom-loader">
      <div class="dot"></div>
    </div>
    <p id="loaderMessage"></p>
  </div>
  
  <!-- Floating Mic Button -->
  <div class="floating-mic" id="floatingMic">
    <canvas id="floatingVisualizer" width="50" height="30" style="display:none; border: 1px solid #fff;"></canvas>

    <i class="fas fa-microphone fa-lg"></i>
    <div id="floatingTimer" class="floating-timer" style="display:none;">00:00</div>
    <!-- Visualizer for Recording -->
  </div>

    <!-- Footer -->
  <footer class="footer py-5 mt-5">
    <div class="container">
      <div class="row gy-4">
        <!-- About -->
        <div class="col-lg-4 col-md-6">
          <a href="{{ url_for('index') }}" class="footer-logo">InvoiceGen</a>
          <p class="mt-3">
            Your AI-powered invoice generator.<br>
            <i class="bi bi-check-circle"></i> Create invoices in seconds<br>
            <i class="bi bi-check-circle"></i> Voice + AI Assistance<br>
            <i class="bi bi-check-circle"></i> Export to PDF & Share
          </p>
        </div>
        <!-- Quick Links -->
        <div class="col-lg-2 col-md-6">
          <h6 class="fw-bold mb-3">Quick Links</h6>
          <ul class="list-unstyled">
            <li><a href="{{ url_for('index') }}">Home</a></li>
            <li><a href="{{ url_for('pricing') }}">Pricing</a></li>
            <li><a href="#">Features</a></li>
            <li><a href="#">FAQs</a></li>
          </ul>
        </div>
        <!-- Resources -->
        <div class="col-lg-3 col-md-6">
          <h6 class="fw-bold mb-3">Resources</h6>
          <ul class="list-unstyled">
            <li><a href="#">Docs</a></li>
            <li><a href="#">Support</a></li>
            <li><a href="#">Privacy Policy</a></li>
            <li><a href="#">Terms of Service</a></li>
          </ul>
        </div>
        <!-- Social Media -->
        <div class="col-lg-3 col-md-6">
          <h6 class="fw-bold mb-3">Follow Us</h6>
          <div class="social-icons">
            <a href="#"><i class="bi bi-twitter"></i></a>
            <a href="#"><i class="bi bi-linkedin"></i></a>
            <a href="#"><i class="bi bi-github"></i></a>
            <a href="#"><i class="bi bi-facebook"></i></a>
          </div>
        </div>
      </div>
      <hr class="mt-4 mb-3">
      <div class="text-center">
        <p class="mb-0">&copy; 2025 InvoiceGen. All rights reserved.</p>
      </div>
    </div>
  </footer>
  
  <!-- Bootstrap 5 JS Bundle -->
   <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <script
    async
    crossorigin="anonymous"
    data-clerk-publishable-key="pk_test_ZGFzaGluZy1wZXJjaC05Ni5jbGVyay5hY2NvdW50cy5kZXYk"
    src="https://cdn.jsdelivr.net/npm/@clerk/clerk-js@latest/dist/clerk.browser.js">
  </script>
  <script src="{{ url_for('static', filename='script.js') }}"></script>

  <!-- Functionality Scripts -->
  <script>
  // Get DOM elements
const voiceTab = document.getElementById('voiceTab');
const textTab = document.getElementById('textTab');
const voiceInput = document.getElementById('voiceInput');
const textInput = document.getElementById('textInput');

// Function to switch active tab and input section
function switchInput(isVoice) {
  if (isVoice) {
    voiceTab.classList.add('active');
    textTab.classList.remove('active');
    voiceInput.classList.remove('d-none');
    textInput.classList.add('d-none');
  } else {
    textTab.classList.add('active');
    voiceTab.classList.remove('active');
    textInput.classList.remove('d-none');
    voiceInput.classList.add('d-none');
  }
}

// Event Listeners for Tab Clicks
voiceTab.addEventListener('click', () => switchInput(true));
textTab.addEventListener('click', () => switchInput(false));

// Set Initial State (Voice Input by default)
switchInput(true);



    // Consolidated DOMContentLoaded handler
    document.addEventListener('DOMContentLoaded', function() {
      // Initialize all functionality
      initLogoUpload();
      initPaymentStatusToggle();
      initToggleButtons();
    });
    
    // Logo upload functionality 
    function initLogoUpload() {
      const logoBox = document.getElementById('logoUploadBox');
      const logoInput = document.getElementById('logoFileInput');
      const originalContent = `
        <div class="upload-content">
            <i class="fas fa-image upload-icon"></i>
            <div class="upload-text">
                <span class="main-text">Upload Logo</span>
                <span class="optional-text">Optional</span>
            </div>
        </div>`;
      logoBox.addEventListener('click', () => {
        logoInput.click();
      });
      logoInput.addEventListener('change', (e) => {
        const file = e.target.files[0];
        if (file) {
          const reader = new FileReader();
          reader.onload = function(evt) {
            logoBox.innerHTML = `
              <img src="${evt.target.result}" alt="Logo Preview">
              <button type="button" class="remove-file" id="removeLogoBtn">
                <i class="fas fa-times"></i>
              </button>`;
            document.getElementById('removeLogoBtn').addEventListener('click', (e) => {
              e.stopPropagation();
              logoInput.value = '';
              logoBox.innerHTML = originalContent;
            });
          };
          reader.readAsDataURL(file);
        }
      });
    }
    
    // Toggle Buttons Initialization for collapsible fields
    function initToggleButtons() {
      document.querySelectorAll('.toggle-btn').forEach(btn => {
        let target = btn.getAttribute('data-bs-target');
        let collapseEl = document.querySelector(target);
        if(collapseEl) {
          collapseEl.addEventListener('hide.bs.collapse', () => {
            btn.textContent = "Add";
            // let clear the value of the input field when it is colllapsed 
            let input = collapseEl.querySelector('input, textarea');
            if (input){
              input.value = '';
            }
          });
          collapseEl.addEventListener('show.bs.collapse', () => {
            btn.textContent = "Remove";
          });
        }
      });
    }
    
    // Payment Status Toggle Initialization
    function initPaymentStatusToggle() {
      const statusRadios = document.querySelectorAll('input[name="payment_status"]');
      const statusLabels = document.querySelectorAll('.status-label');

      // Set initial state for toggle labels
      const defaultStatus = document.querySelector('input[name="payment_status"]:checked');
      if (defaultStatus) {
        const defaultLabel = document.querySelector(`label[for="${defaultStatus.id}"]`);
        defaultLabel.classList.add('active');
      }

      // Add click event to each label
      statusLabels.forEach(label => {
        label.addEventListener('click', function() {
          statusLabels.forEach(l => l.classList.remove('active'));
          this.classList.add('active');

          // Ensure the corresponding radio is checked
          const radio = document.getElementById(this.getAttribute('for'));
          if (radio) {
            radio.checked = true;
          }
        });
      });
    }
  

    // loader overlay logic.
    function showLoader(message) {
      document.getElementById('loaderMessage').textContent = message;
      document.getElementById('loaderOverlay').style.display = 'flex';
    }
    function hideLoader() {
      document.getElementById('loaderOverlay').style.display = 'none';
    }
  
    // Audio recording logic.
    let mediaRecorder;
let audioChunks = [];
let isRecording = false;  // To track recording status

let timerInterval;
let elapsedTime = 0;

// Get DOM elements
const recordButton = document.getElementById('recordButton');
const stopButton = document.getElementById('stopButton');
const floatingMic = document.getElementById('floatingMic');
// const loaderOverlay = document.getElementById('loaderOverlay');  // The loader overlay
// const loaderMessage = document.getElementById('loaderMessage');  // The loader message
const floatingTimer = document.getElementById('floatingTimer');
const floatingVisualizer = document.getElementById('floatingVisualizer');
const voiceTimer = document.getElementById('voiceTimer');
const visualizer = document.getElementById('visualizer');



// Add event listeners for recording and stop buttons
recordButton.addEventListener('click', startRecording);
stopButton.addEventListener('click', stopRecording);
floatingMic.addEventListener('click', toggleRecording);

// Function to start recording
async function startRecording() {
  // Disable the record button and enable the stop button
  recordButton.disabled = true;
  stopButton.disabled = false;

  // Start the media recording process
  let stream = await navigator.mediaDevices.getUserMedia({ audio: true });
  mediaRecorder = new MediaRecorder(stream);
  audioChunks = [];

  mediaRecorder.ondataavailable = event => audioChunks.push(event.data);
  mediaRecorder.onstop = async () => {
    showLoader("Processing voice transcription...");
    let audioBlob = new Blob(audioChunks, { type: 'audio/webm' });
    let formData = new FormData();
    formData.append('audio', audioBlob, 'recorded_audio.webm');

    // Show the loader while waiting for transcription
    // showLoader('Processing your voice...');

    // Send audio to backend for transcription
    let response = await fetch('/upload_audio', {
      method: 'POST',
      body: formData
    });
    let result = await response.json();
    hideLoader(); 
        if (result.invoice_content) {
          populateInvoiceForm(result.invoice_content.invoice);
        } else {
          alert("Error: " + (result.error || "Unknown error"));
        }

    // if (result.transcription) {
    //   // Render the transcription result or do further actions here
    //   console.log(result.transcription);
    //   // You can display the transcription result, save it, or trigger further actions
    // } else {
    //   alert('Transcription failed or no content found');
    // }
  };

  // Start recording
  mediaRecorder.start();

  document.querySelector('#timer-visualizer').style.display = 'block';
  document.querySelector('#floatingTimer').style.display = 'block';
  document.querySelector('#floatingVisualizer').style.display = 'block';

  //start teh timer and visualizer
  startTimer();
  startVisualizer(stream);

  // Update the floating mic button appearance (show recording state)
  floatingMic.classList.add('recording');
  document.querySelector('#floatingMic i').classList.add('recording');  // Switch to stop icon
  floatingMic.querySelector('i').classList.remove('fa-microphone');  // Remove microphone icon
  floatingMic.querySelector('i').classList.add('fa-stop-circle');  // Add stop icon
  floatingMic.style.background = "#ff3d00";  // Change to red background

  isRecording = true;
}

// Function to stop recording
function stopRecording() {
  // Stop the media recorder
  mediaRecorder.stop();

// stop the timer and visualizer
  stopTimer();
  stopVisualizer();

  document.querySelector('#timer-visualizer').style.display = 'none';
  document.querySelector('#floatingTimer').style.display = 'none';
  document.querySelector('#floatingVisualizer').style.display = 'none';

  // Enable the record button and disable the stop button
  recordButton.disabled = false;
  stopButton.disabled = true;

  // Update the floating mic button appearance
  floatingMic.classList.remove('recording');
  document.querySelector('#floatingMic i').classList.remove('recording');
  floatingMic.querySelector('i').classList.remove('fa-stop-circle');
  floatingMic.querySelector('i').classList.add('fa-microphone');  // back to mic icon
  floatingMic.style.background = "#6d5cff";  // Reset to original color

  isRecording = false;
}

// Function to toggle recording state with the floating mic button
function toggleRecording() {
  if (isRecording) {
    // Stop recording if already recording
    mediaRecorder.stop();
    stopTimer();

    document.querySelector('#timer-visualizer').style.display = 'none';
    document.querySelector('#floatingTimer').style.display = 'none';
    document.querySelector('#floatingVisualizer').style.display = 'none';
  
    floatingMic.classList.remove('recording');
    document.querySelector('#floatingMic i').classList.remove('recording');
    floatingMic.querySelector('i').classList.remove('fa-stop-circle');
    floatingMic.querySelector('i').classList.add('fa-microphone');  // Reset to mic icon
    floatingMic.style.background = "#6d5cff";  // Reset to original color

    // Enable record button and disable stop button
    recordButton.disabled = false;
    stopButton.disabled = true;
    isRecording = false;
  } else {
    // Start recording if not already recording
    startRecording();
  }
}


// Timer logic
function startTimer() {
  timerInterval = setInterval(() => {
    elapsedTime++;
    const minutes = Math.floor(elapsedTime / 60);
    const seconds = elapsedTime % 60;
    const formattedTime = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
    voiceTimer.textContent = formattedTime;
    floatingTimer.textContent = formattedTime; // Show time on floating mic button
  }, 1000);
}

function stopTimer() {
  clearInterval(timerInterval);
  elapsedTime = 0; // Reset timer when stopped
  voiceTimer.textContent = "00:00"; // Reset timer display
  floatingTimer.textContent = "00:00"; // Reset timer display on floating mic button
}

// Visualizer logic
let analyser;
let canvasContext;
let bufferLength;
let dataArray;

function startVisualizer(stream) {
  const audioContext = new (window.AudioContext || window.webkitAudioContext)();
  analyser = audioContext.createAnalyser();
  const source = audioContext.createMediaStreamSource(stream);
  source.connect(analyser);
  analyser.fftSize = 256; // This affects the "frequencyBinCount"
  bufferLength = analyser.frequencyBinCount;
  dataArray = new Uint8Array(bufferLength);

  // Make sure canvas is properly initialized
  if (floatingVisualizer) {
    canvasContext = floatingVisualizer.getContext('2d');
    floatingVisualizer.width = 50; 
    floatingVisualizer.height = 30; 
    drawVisualizer(canvasContext);
  }

  // Visualizer for the main voice input section
  if (visualizer) {
    const inputCanvas = visualizer.getContext('2d');
    visualizer.width = 100; 
    visualizer.height = 40; 
    drawVisualizer(inputCanvas);
  }
}

function stopVisualizer() {
  if (analyser) {
    analyser.disconnect(); 
  }

  // Clear the canvases
  if (floatingVisualizer) {
    floatingVisualizer.getContext('2d').clearRect(0, 0, floatingVisualizer.width, floatingVisualizer.height); // Clear floating mic visualizer
  }

  if (visualizer) {
    visualizer.getContext('2d').clearRect(0, 0, visualizer.width, visualizer.height); // Clear visualizer in voice input section
  }
}

function drawVisualizer(canvasContext) {
  // Clear canvas before drawing
  canvasContext.clearRect(0, 0, canvasContext.canvas.width, canvasContext.canvas.height);

  analyser.getByteFrequencyData(dataArray); // Get frequency data

  const barWidth = (canvasContext.canvas.width / bufferLength) * 2.5;
  let x = 0;

  // Draw the frequency bars
  for (let i = 0; i < bufferLength; i++) {
    const barHeight = dataArray[i];
    const r = barHeight + 100; // Red component for color
    const g = 50;
    const b = 255 - barHeight;
    // const b = 50;

    canvasContext.fillStyle = '#d5d5d5';
    // Set the color dynamically based on the bar height
    // canvasContext.fillStyle = `rgb(${r}, ${g}, ${b})`;
    canvasContext.fillRect(x, canvasContext.canvas.height - barHeight / 2, barWidth, barHeight);

    x += barWidth + 1; // Move x position for next bar
  }

  requestAnimationFrame(() => drawVisualizer(canvasContext)); // Call next frame
}

    // Text invoice input logic.
    document.getElementById('generateTextBtn').addEventListener('click', async () => {
      const invoiceText = document.getElementById('invoiceText').value.trim();
      if (!invoiceText) {
        alert("Please enter invoice details.");
        return;
      }
      showLoader("Generating invoice from text...");
      let formData = new FormData();
      formData.append('invoiceText', invoiceText);
      const response = await fetch('/generate_invoice_text', { method: 'POST', body: formData });
      const result = await response.json();
      hideLoader();
      if(result.invoice_content){
         populateInvoiceForm(result.invoice_content.invoice);
      } else {
         alert("Error generating invoice from text: " + (result.error || "Unknown error"));
      }
    });
  
    function populateInvoiceForm(invoice) {
      document.getElementById('invoiceFormDiv').style.display = 'block';
      // Enable scrolling when the form is open
      document.body.style.overflow = 'auto';
      document.getElementById('invoiceNumber').value = invoice.invoiceNumber || "";
      document.getElementById('issueDate').value = invoice.issueDate || "";
      document.getElementById('dueDate').value = invoice.dueDate || "";
      document.getElementById('issuerName').value = invoice.issuer_info?.name || "";
      document.getElementById('issuerContact').value = invoice.issuer_info?.contact || "";
      document.getElementById('issuerAddress').value = invoice.issuer_info?.address || "";
      document.getElementById('issuerEmail').value = invoice.issuer_info?.email || "";
      document.getElementById('clientName').value = invoice.client?.name || "";
      document.getElementById('clientContact').value = invoice.client?.contact || "";
      document.getElementById('clientAddress').value = invoice.client?.address || "";
      document.getElementById('clientEmail').value = invoice.client?.email || "";
      document.getElementById('shippingCost').value = invoice.shippingCost || invoice.shipping_cost || "";
      document.getElementById('vatAmount').value = invoice.vatAmount || "";
      document.getElementById('taxAmount').value = invoice.taxAmount || "";
      document.getElementById('totalAmount').value = invoice.totalAmount || "";
      document.getElementById('paymentMethod').value = invoice.paymentMethod || "";
      document.getElementById('endNote').value = invoice.endNote || invoice.endnote || "";

       // Scroll the form into view if needed
  document.getElementById('invoiceFormDiv').scrollIntoView({ behavior: 'smooth' });
  
      if(invoice.currency) {
          document.getElementById('currencySelection').value = invoice.currency;
      }
      if(invoice.shippingCost) {
        document.getElementById('shippingCost').value = invoice.shippingCost;
      }
      
      const servicesContainer = document.getElementById('servicesContainer');
      servicesContainer.innerHTML = "";
      if (invoice.serviceDetails && invoice.serviceDetails.length > 0) {
        invoice.serviceDetails.forEach((service, index) => {
          addServiceRowToDOM(index, service.description, service.quantity, service.unitPrice, service.totalPrice, service.vatPercentage);
        });
      }
      document.getElementById('invoiceFormDiv').scrollIntoView({ behavior: 'smooth' });
       // Call recalculateTotals to ensure subtotal is calculated immediately
      recalculateTotals();
    }


    function addServiceRowToDOM(index, description = "", quantity = 0, unitPrice = "", totalPrice = "", vatPercentage = "") {
      let currency = document.getElementById('currencySelection').value;
      let examplePlaceholder = currency + "0.00";
  
      let div = document.createElement('div');
      div.classList.add("service-row");
      div.innerHTML = `
        <i class="bi bi-x-circle remove-service"></i>
        <div class="row g-3">
          <div class="col-md-6">
            <label class="form-label">Service ${index + 1} Description</label>
            <input type="text" class="form-control" name="service${index}_description" placeholder="Enter service description" value="${description}">
          </div>
          <div class="col-md-3">
            <label class="form-label">Quantity</label>
            <input type="number" class="form-control" name="service${index}_quantity" placeholder="0" value="${quantity}">
          </div>
          <div class="col-md-3">
            <label class="form-label">Unit Price</label>
            <input type="text" class="form-control" name="service${index}_unitPrice" placeholder="${examplePlaceholder}" value="${unitPrice}">
          </div>
        </div>
        <div class="row g-3 mt-2">
          <div class="col-md-12">
            <label class="form-label">Total Price</label>
            <input type="text" class="form-control" name="service${index}_totalPrice" placeholder="Enter total price" value="${totalPrice}" readonly>
          </div>
        </div>
      `;
      // Remove service event.
  div.querySelector('.remove-service').addEventListener('click', function() {
    div.remove();
    recalculateTotalAmount();
  });
  
 // Update calculation on quantity and unit price input.
 const quantityInput = div.querySelector(`[name="service${index}_quantity"]`);
      const unitPriceInput = div.querySelector(`[name="service${index}_unitPrice"]`);
      
      [quantityInput, unitPriceInput].forEach(input => {
        input.addEventListener('input', function() {
          updateServiceTotal(div, index);
          recalculateTotals();
        });
      });
      
      document.getElementById('servicesContainer').appendChild(div);
      updateServiceTotal(div, index);
    }
    
    // Calculate and update total price for a service row
    function updateServiceTotal(serviceRow, index) {
      let quantity = parseFloat(serviceRow.querySelector(`[name="service${index}_quantity"]`).value) || 0;
      let unitPriceStr = serviceRow.querySelector(`[name="service${index}_unitPrice"]`).value;
      let unitPrice = parseFloat(unitPriceStr.replace(/[^0-9.]/g, '')) || 0;
      let totalPrice = quantity * unitPrice;
      let currency = document.getElementById('currencySelection').value;
      serviceRow.querySelector(`[name="service${index}_totalPrice"]`).value = currency + totalPrice.toFixed(2);
    }
    
    // When currency selection changes, update service rows and overall totals.
    document.getElementById('currencySelection').addEventListener('change', function() {
      let currency = document.getElementById('currencySelection').value;
      let examplePlaceholder = currency + "0.00";
      let serviceRows = document.querySelectorAll('#servicesContainer .service-row');
      
      serviceRows.forEach((serviceRow, index) => {
        let unitPriceInput = serviceRow.querySelector(`[name="service${index}_unitPrice"]`);
        let rawUnitPrice = unitPriceInput.value;
        let numericUnitPrice = parseFloat(rawUnitPrice.replace(/[^0-9.]/g, '')) || 0;
        unitPriceInput.placeholder = examplePlaceholder;
        if(rawUnitPrice.trim() !== "") {
          unitPriceInput.value = numericUnitPrice ? numericUnitPrice.toFixed(2) : "";
        }
        updateServiceTotal(serviceRow, index);
      });
      recalculateTotals();
    });


    // Recalculate overall totals when VAT, TAX, or Shipping Cost changes.
document.addEventListener('DOMContentLoaded', function() {
    // Add event listener for VAT input
    document.getElementById('vatAmount').addEventListener('input', recalculateTotals);
    document.getElementById('vatOption').addEventListener('change', recalculateTotals);

    // Add event listener for TAX input
    document.getElementById('taxAmount').addEventListener('input', recalculateTotals);
    document.getElementById('taxOption').addEventListener('change', recalculateTotals);

    // Add event listener for Shipping Cost input so overall totals recalculate when changed.
    document.getElementById('shippingCost').addEventListener('input', recalculateTotals);
});

function recalculateTotals() {
    let subtotal = 0;
    let serviceRows = document.querySelectorAll('#servicesContainer .service-row');
    serviceRows.forEach((serviceRow, index) => {
        let rawTotal = serviceRow.querySelector(`[name="service${index}_totalPrice"]`).value;
        let numericTotal = parseFloat(rawTotal.replace(/[^0-9.]/g, '')) || 0;
        subtotal += numericTotal;
    });
    let currency = document.getElementById('currencySelection').value;
    document.getElementById('serviceSubtotal').value = currency + subtotal.toFixed(2);
    
    // Calculate VAT
    let vatAmountStr = document.getElementById('vatAmount').value;
    let vatAmount = parseFloat(vatAmountStr) || 0;
    let vatOption = document.getElementById('vatOption').value;
    let vat_amount = (vatOption === "percentage") ? subtotal * (vatAmount / 100) : vatAmount;
    
    // Calculate TAX
    let taxAmountStr = document.getElementById('taxAmount').value;
    let taxAmount = parseFloat(taxAmountStr) || 0;
    let taxOption = document.getElementById('taxOption').value;
    let tax_amount = (taxOption === "percentage") ? subtotal * (taxAmount / 100) : taxAmount;
    
    let shippingStr = document.getElementById('shippingCost').value;
    let shipping = parseFloat(shippingStr.replace(/[^0-9.]/g, '')) || 0;
    
    let finalTotal = subtotal + vat_amount + tax_amount + shipping;
    document.getElementById('totalAmount').value = currency + finalTotal.toFixed(2);
}


    // add service row
    document.getElementById('addServiceRow').addEventListener('click', function() {
      let serviceRows = document.querySelectorAll('#servicesContainer .service-row');
      let index = serviceRows.length;
      addServiceRowToDOM(index);
    });
    
    // Clear input values when a collapsible field is hidden.
    var collapseIssueDate = document.getElementById('collapseIssueDate');
    collapseIssueDate.addEventListener('hide.bs.collapse', function () {
      document.getElementById('issueDate').value = "";
    });
    var collapseDueDate = document.getElementById('collapseDueDate');
    collapseDueDate.addEventListener('hide.bs.collapse', function () {
      document.getElementById('dueDate').value = "";
    });
    var collapseIssuerEmail = document.getElementById('collapseIssuerEmail');
    collapseIssuerEmail.addEventListener('hide.bs.collapse', function () {
      document.getElementById('issuerEmail').value = "";
    });
    var collapseIssuerAddress = document.getElementById('collapseIssuerAddress');
    collapseIssuerAddress.addEventListener('hide.bs.collapse', function () {
      document.getElementById('issuerAddress').value = "";
    });
    var collapseIssuerContact = document.getElementById('collapseIssuerContact');
    collapseIssuerContact.addEventListener('hide.bs.collapse', function () {
      document.getElementById('issuerContact').value = "";
    });
    var collapseClientEmail = document.getElementById('collapseClientEmail');
    collapseClientEmail.addEventListener('hide.bs.collapse', function () {
      document.getElementById('clientEmail').value = "";
    });
    var collapseClientContact = document.getElementById('collapseClientContact');
    collapseClientContact.addEventListener('hide.bs.collapse', function () {
      document.getElementById('clientContact').value = "";
    });
    var collapseClientAddress = document.getElementById('collapseClientAddress');
    collapseClientAddress.addEventListener('hide.bs.collapse', function () {
      document.getElementById('clientAddress').value = "";
    });
    var collapseVatAmount = document.getElementById('collapseVatAmount');
collapseVatAmount.addEventListener('hide.bs.collapse', function () {
    document.getElementById('vatAmount').value = "";
});
var collapseTaxAmount = document.getElementById('collapseTaxAmount');
collapseTaxAmount.addEventListener('hide.bs.collapse', function () {
    document.getElementById('taxAmount').value = "";
});
    var collapseShippingCost = document.getElementById('collapseShippingCost');
    collapseShippingCost.addEventListener('hide.bs.collapse', function () {
      document.getElementById('shippingCost').value = "";
    });
    var collapsePaymentMethod = document.getElementById('collapsePaymentMethod');
    collapsePaymentMethod.addEventListener('hide.bs.collapse', function () {
      document.getElementById('paymentMethod').value = "";
    });
    var collapseEndNote = document.getElementById('collapseEndNote');
    collapseEndNote.addEventListener('hide.bs.collapse', function () {
      document.getElementById('endNote').value = "";
    });

    
  </script>
</body>
</html>